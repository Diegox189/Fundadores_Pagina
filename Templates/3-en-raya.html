<!DOCTYPE html><html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>3 en raya</title>
  <style>
    :root{
      --bg: #0b0f14; 
      --panel:#111722; 
      --accent:#6ee7ff; 
      --x:#f59e0b; 
      --o:#60a5fa; 
      --win:#22c55e; 
      --muted:#94a3b8;
    }
    *{ box-sizing: border-box; }
    body{
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, "Helvetica Neue", Arial, "Apple Color Emoji", "Segoe UI Emoji";
      background: linear-gradient(180deg, #0b0f14, #0f172a);
      color: #e5e7eb;
      min-height: 100svh;
      display: grid;
      place-items: center;
      padding: 24px;
    }
    .app{ 
      width: min(440px, 92vw);
      background: var(--panel);
      border-radius: 20px;
      padding: 20px;
      box-shadow: 0 10px 40px rgba(0,0,0,.5);
    }
    .header{ display:flex; align-items:center; justify-content:space-between; gap:12px; margin-bottom:16px; }
    .header strong{ font-size: 1.25rem; letter-spacing:.2px; }select, button{ 
  background:#0b1220; color:#e5e7eb; border:1px solid rgba(255,255,255,.12); 
  border-radius:12px; padding:10px 12px; font-weight:600; cursor:pointer; 
}
select{ padding-right: 32px; }
button:hover{ filter: brightness(1.1); }
button:active{ transform: translateY(1px); }
button:focus-visible, select:focus-visible{ outline:2px solid var(--accent); outline-offset:2px; }

.controls{ display:flex; gap:8px; align-items:center; }

.score{ 
  display:grid; grid-template-columns: repeat(4, 1fr); gap:10px; 
  background:#0b1220; padding:12px; border-radius:12px; 
  font-variant-numeric: tabular-nums;
}
.score div{ background:#0a0f1a; border:1px solid rgba(255,255,255,.06); border-radius:10px; padding:8px 10px; text-align:center; }
.score div:nth-child(1){ color: var(--x); }
.score div:nth-child(2){ color: var(--o); }
.badge{ padding:2px 8px; border-radius:999px; background:#111827; font-size:12px; color: var(--muted); }

.status{ margin:12px 0 14px; min-height:1.6em; color:#cbd5e1; }

.board{ display:grid; grid-template-columns: repeat(3, 1fr); gap:10px; }
.cell{ 
  aspect-ratio:1; 
  border:1px solid rgba(255,255,255,.12); 
  background:#0b1220; 
  border-radius:14px; 
  font-size: clamp(34px, 11vw, 56px); 
  font-weight:700; 
  display:grid; place-items:center; 
  cursor:pointer; 
  transition: transform .06s ease, background .2s ease, border-color .2s ease; 
  user-select: none;
}
.cell:hover{ transform: translateY(-1px); }
.cell:focus-visible{ outline:2px solid var(--accent); outline-offset:2px; }
.cell.win{ background: rgba(34,197,94,.15); border-color: var(--win); transform: scale(1.02); }
.mark-x{ color: var(--x); text-shadow: 0 2px 10px rgba(245,158,11,.15); }
.mark-o{ color: var(--o); text-shadow: 0 2px 10px rgba(96,165,250,.15); }

.hint{ color: var(--muted); display:block; margin-top:8px; text-align:center; font-size:.9rem; }
.sr-only{ position:absolute; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0; }

  </style>
</head>
<body>
  <div class="app" role="application" aria-label="Juego 3 en raya">
    <div class="header">
      <strong>3 en raya</strong>
      <div class="controls">
        <label for="mode" class="sr-only">Modo</label>
        <select id="mode" aria-label="Modo de juego">
          <option value="human">2 jugadores</option>
          <option value="cpu-easy">vs CPU (F√°cil)</option>
          <option value="cpu-hard">vs CPU (Imposible)</option>
        </select>
        <button id="reset">Reiniciar</button>
      </div>
    </div><div class="score" aria-label="Marcador">
  <div>‚úñ X: <span id="scoreX">0</span></div>
  <div>‚≠ï O: <span id="scoreO">0</span></div>
  <div>ü§ù Empates: <span id="scoreD">0</span></div>
  <div><span class="badge">Turno: <span id="turn">X</span></span></div>
</div>

<div class="status" id="status" aria-live="polite"></div>

<div class="board" id="board" role="grid" aria-label="Tablero de 3 por 3"></div>

<small class="hint">Usa ‚Üê ‚Üë ‚Üí ‚Üì para moverte y Enter/Espacio para marcar.</small>

  </div>  <script>
  (()=>{
    const boardEl = document.getElementById('board');
    const statusEl = document.getElementById('status');
    const turnEl = document.getElementById('turn');
    const modeEl = document.getElementById('mode');
    const resetBtn = document.getElementById('reset');
    const scoreEls = { X: document.getElementById('scoreX'), O: document.getElementById('scoreO'), D: document.getElementById('scoreD') };

    const WINS = [
      [0,1,2],[3,4,5],[6,7,8],
      [0,3,6],[1,4,7],[2,5,8],
      [0,4,8],[2,4,6]
    ];

    let state, current, running, scores;

    function init(preserveScores=false){
      state = Array(9).fill(null);
      current = 'X';
      running = true;
      status('');
      turnEl.textContent = current;
      renderBoard();
      if(!preserveScores){
        scores = { X:0, O:0, D:0 };
        updateScores();
      }
      maybeCPUPlay();
    }

    function status(text){ statusEl.textContent = text || ''; }

    function updateScores(){
      scoreEls.X.textContent = scores.X;
      scoreEls.O.textContent = scores.O;
      scoreEls.D.textContent = scores.D;
    }

    function renderBoard(){
      boardEl.innerHTML = '';
      for (let i=0;i<9;i++){
        const btn = document.createElement('button');
        btn.className = 'cell';
        btn.setAttribute('role','gridcell');
        btn.setAttribute('data-idx', String(i));
        btn.setAttribute('aria-label', `Casilla ${i+1}`);
        btn.addEventListener('click', onCellClick);
        btn.addEventListener('keydown', onCellKey);
        boardEl.appendChild(btn);
      }
      restoreMarks();
    }

    function restoreMarks(){
      for(let i=0;i<9;i++){
        const val = state[i];
        if(val){
          const cell = boardEl.children[i];
          cell.textContent = val === 'X' ? '‚úñ' : '‚≠ï';
          cell.classList.add(val === 'X' ? 'mark-x' : 'mark-o');
          cell.setAttribute('aria-pressed','true');
        }
      }
    }

    function onCellClick(e){
      const idx = Number(e.currentTarget.dataset.idx);
      playAt(idx);
    }

    function onCellKey(e){
      const idx = Number(e.currentTarget.dataset.idx);
      const row = Math.floor(idx/3), col = idx%3;
      if (['ArrowLeft','ArrowRight','ArrowUp','ArrowDown'].includes(e.key)){
        e.preventDefault();
        let r = row, c = col;
        if (e.key==='ArrowLeft') c = (c+2)%3;
        if (e.key==='ArrowRight') c = (c+1)%3;
        if (e.key==='ArrowUp') r = (r+2)%3;
        if (e.key==='ArrowDown') r = (r+1)%3;
        const next = r*3 + c;
        boardEl.children[next].focus();
      } else if (e.key==='Enter' || e.key===' '){
        e.preventDefault();
        playAt(idx);
      }
    }

    function playAt(idx){
      if (!running || state[idx]) return;
      setMark(idx, current);
      const result = checkEnd();
      if (result) { endGame(result); return; }
      swapTurn();
      maybeCPUPlay();
    }

    function setMark(idx, player){
      state[idx] = player;
      const cell = boardEl.children[idx];
      cell.textContent = player === 'X' ? '‚úñ' : '‚≠ï';
      cell.classList.add(player === 'X' ? 'mark-x' : 'mark-o');
      cell.setAttribute('aria-pressed','true');
    }

    function swapTurn(){
      current = current === 'X' ? 'O' : 'X';
      turnEl.textContent = current;
    }

    function checkEnd(){
      for (const line of WINS){
        const [a,b,c] = line;
        if (state[a] && state[a]===state[b] && state[a]===state[c]){
          return { winner: state[a], line };
        }
      }
      if (state.every(Boolean)) return { draw:true };
      return null;
    }

    function endGame(res){
      running = false;
      if (res.draw){
        status('¬°Empate!');
        scores.D++;
      } else {
        status(`¬°${res.winner} gan√≥!`);
        for (const i of res.line){
          boardEl.children[i].classList.add('win');
        }
        scores[res.winner]++;
      }
      updateScores();
    }

    function emptyIndices(st=state){ const arr=[]; for(let i=0;i<9;i++) if(!st[i]) arr.push(i); return arr; }

    function cpuMoveEasy(){
      const empties = emptyIndices();
      if (empties.length===0) return;
      const idx = empties[Math.floor(Math.random()*empties.length)];
      playAt(idx);
    }

    function cpuMoveHard(){
      const best = minimax(state, current).index;
      if (best != null) playAt(best);
    }

    function maybeCPUPlay(){
      if (!running) return;
      const mode = modeEl.value;
      // Humano siempre es X en modo CPU; la CPU juega como O
      if (mode !== 'human' && current==='O'){
        const delay = 250 + Math.random()*350;
        setTimeout(() => {
          if (!running) return;
          if (mode === 'cpu-easy') cpuMoveEasy();
          else cpuMoveHard();
        }, delay);
      }
    }

    // Minimax para 3 en raya (CPU imbatible como 'O')
    function minimax(newState, player){
      const avail = emptyIndices(newState);
      const res = checkTerminal(newState);
      if (res) {
        if (res.winner === 'X') return { score: -10 };
        if (res.winner === 'O') return { score: 10 };
        if (res.draw) return { score: 0 };
      }
      const moves = [];
      for (const i of avail){
        const move = { index: i };
        newState[i] = player;
        const next = player === 'O' ? 'X' : 'O';
        const result = minimax(newState, next);
        move.score = result.score;
        newState[i] = null;
        moves.push(move);
      }
      let bestMove, bestScore;
      if (player === 'O'){ // maximiza
        bestScore = -Infinity;
        for (const m of moves){ if (m.score > bestScore){ bestScore = m.score; bestMove = m; } }
      } else { // minimiza
        bestScore = Infinity;
        for (const m of moves){ if (m.score < bestScore){ bestScore = m.score; bestMove = m; } }
      }
      return bestMove || { index: avail[0], score: 0 };
    }

    function checkTerminal(st){
      for (const line of WINS){
        const [a,b,c] = line;
        if (st[a] && st[a]===st[b] && st[a]===st[c]){
          return { winner: st[a] };
        }
      }
      if (st.every(Boolean)) return { draw:true };
      return null;
    }

    resetBtn.addEventListener('click', () => init(true));
    modeEl.addEventListener('change', () => init(true));

    // iniciar preservando el marcador
    scores = { X:0, O:0, D:0 };
    updateScores();
    init(true);
  })();
  </script></body>
</html>